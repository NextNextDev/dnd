<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–æ—Å—Ç–µ–¥—Ä–æ–± –¢—É–º–∞–Ω–æ—Ö–≤–æ—Å—Ç ‚Äî –ª–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
  <style>
    :root{
      --bg:#0e1116;
      --panel:#151a22;
      --panel-2:#1b2230;
      --text:#e9eef5;
      --muted:#a8b3c7;
      --accent:#7fd1ff;
      --ok:#72d572;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --border:#2a3242;
      --radius:12px;
      --gap:14px;
      --shadow:0 6px 20px rgba(0,0,0,.35);
      --pip-size:22px;
      --mini:64px;
      --font:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#0b0e13,#0f1420 45%,#0b0e13);
      color:var(--text); font-family:var(--font); line-height:1.45;
    }
    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:1200px; margin:32px auto; padding:0 18px}
    header.hero{
      display:grid; gap:var(--gap);
      grid-template-columns: 1fr; margin-bottom:18px;
    }
    .title{
      background:var(--panel); border:1px solid var(--border); border-radius:var(--radius);
      padding:18px; box-shadow:var(--shadow);
    }
    .title h1{margin:.2rem 0 0; font-size:1.8rem; letter-spacing:.5px}
    .title .meta{color:var(--muted); margin-top:.2rem}
    .grid{
      display:grid; gap:var(--gap);
      grid-template-columns: 1fr;
    }
    @media (min-width:1100px){
      .grid{grid-template-columns: minmax(320px, 420px) 1fr;}
    }

    /* –ü–æ—Ä—Ç—Ä–µ—Ç */
    .portrait-card{
      background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:12px;
    }
    .portrait{
      position:relative; width:100%; aspect-ratio:2/3; max-width:360px; margin:auto;
      border-radius:10px; overflow:hidden; background:
        repeating-conic-gradient(from 45deg, #101620 0 25%, #0d121a 0 50%) 0 0/40px 40px;
      border:1px dashed #364056;
      display:flex; align-items:center; justify-content:center;
      color:var(--muted);
    }
    .portrait img{
      width:100%; height:100%; object-fit:cover; display:block;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
    .card{
      background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:16px;
    }
    h2{margin:.2rem 0 12px; font-size:1.2rem; letter-spacing:.3px}
    .stats{
      display:grid; gap:10px; grid-template-columns: repeat(5, minmax(90px, 1fr));
    }
    .stat{
      background:var(--panel-2); border:1px solid var(--border); border-radius:10px; padding:10px; text-align:center;
    }
    .stat .abbr{font-size:.8rem; color:var(--muted); letter-spacing:.4px}
    .stat .value{font-size:1.6rem; font-weight:700; margin-top:2px}
    .note{font-size:.92rem; color:var(--muted); margin-top:8px}

    .racefix{background:#0f1624; border:1px solid #263149; padding:10px 12px; border-radius:10px; margin-top:10px; color:#cfe4ff}

    /* –°—á—ë—Ç—á–∏–∫–∏ */
    .ability{display:grid; gap:12px; grid-template-columns:auto 1fr; align-items:flex-start;}
    .ability + .ability{margin-top:10px}
    .ability-icon{width:60px; height:60px; border-radius:10px; border:1px solid var(--border); background:#0f1623; padding:6px; object-fit:contain; box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);}
    .ability .counter-tools{grid-column:2; display:flex; gap:8px; align-items:center; margin-top:4px;}
    @media (max-width:700px){
      .ability{grid-template-columns:1fr;}
      .ability-icon{justify-self:center;}
      .ability .counter-tools{grid-column:1;}
    }
    .ability .desc{color:var(--muted); font-size:.95rem}
    .pips{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .pip{
      width:var(--pip-size); height:var(--pip-size);
      border:1px solid var(--border); border-radius:6px; background:#0f1623; cursor:pointer;
      display:grid; place-items:center; transition:.12s;
    }
    .pip[aria-pressed="true"]{background:var(--accent); border-color:var(--accent); color:#0b0e13}
    .pip:focus{outline:2px solid var(--accent); outline-offset:2px}
    .counter-tools{display:flex; gap:6px; align-items:center}
    .btn, button, input[type=number]{
      font:inherit; color:var(--text);
    }
    .btn{
      border:1px solid var(--border); background:#162132; padding:6px 10px; border-radius:8px; cursor:pointer;
    }
    .btn:hover{background:#1a2740}
    .btn.warn{background:#2a1a1a; border-color:#4b2323}
    .btn.warn:hover{background:#3a2020}
    .small{font-size:.9rem; color:var(--muted)}

    /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
    .inv-list{display:grid; gap:10px}
    .item{
      display:grid; gap:10px; align-items:flex-start;
      grid-template-columns: var(--mini) 1fr;
      background:var(--panel-2); border:1px solid var(--border); border-radius:10px; padding:10px;
    }
    .item .mini{
      width:var(--mini); height:var(--mini); border-radius:8px; border:1px dashed #3a4864; background:#0e1522; display:grid; place-items:center; color:var(--muted); font-size:.8rem; text-align:center; padding:6px; user-select:none; position:relative; overflow:hidden;
      cursor:pointer;
    }
    .item .mini img{width:100%; height:100%; object-fit:contain; display:none}
    .item h3{margin:0; font-size:1rem}
    .item .sub{color:var(--muted); font-size:.92rem}
    .item .controls{display:flex; gap:8px; align-items:center; justify-content:flex-start; grid-column:1 / -1; margin-top:6px; flex-wrap:wrap}
    .item input[type=file]{display:none}

    /* –ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è */
    .story{white-space:pre-wrap; background:#0f1624; border:1px solid #263149; padding:12px; border-radius:10px; color:#d8e7ff}

    /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin:12px 0 18px;
    }
    .toolbar .left,.toolbar .right{display:flex; gap:10px; align-items:center}

    @media print{
      body{background:#fff; color:#000}
      .title, .card, .portrait-card{box-shadow:none}
      .btn, .clear{display:none !important}
      .item{border-color:#ccc}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div class="title">
        <div class="meta">ü¶ù –¢–∞–Ω—É–∫–∏ ‚Ä¢ –í–æ—Ä</div>
        <h1>–ö–æ—Å—Ç–µ–¥—Ä–æ–± –¢—É–º–∞–Ω–æ—Ö–≤–æ—Å—Ç</h1>
        <div class="meta">–¢–µ–ª–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –î–∂–æ–Ω–Ω–∏ ¬´–ß—ë—Ä–Ω–∞—è –†—É–∫–∞¬ª. –ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ: —Ö–∞–æ—Ç–∏—á–Ω–æ‚Äë–¥–æ–±—Ä—ã–π —Ç—Ä–∏–∫—Å—Ç–µ—Ä.</div>
      </div>
    </header>

    <div class="grid">
      <!-- –ü–æ—Ä—Ç—Ä–µ—Ç -->
      <section class="portrait-card">
        <h2>–ü–æ—Ä—Ç—Ä–µ—Ç</h2>
        <div class="portrait">
          <img src="img/avatar.png" alt="–ü–æ—Ä—Ç—Ä–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" loading="lazy"/>
        </div>
      </section>

      <main class="main">
        <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
        <section class="card">
          <h2>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
          <div class="stats">
            <div class="stat"><div class="abbr">–°–∏–ª–∞</div><div class="value">8</div></div>
            <div class="stat"><div class="abbr">–õ–æ–≤–∫–æ—Å—Ç—å</div><div class="value">17</div></div>
            <div class="stat"><div class="abbr">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div><div class="value">13</div></div>
            <div class="stat"><div class="abbr">–•–∞—Ä–∏–∑–º–∞</div><div class="value">6</div></div>
            <div class="stat"><div class="abbr">–£–¥–∞—á–∞</div><div class="value">8</div></div>
          </div>
          <div class="note">–§–∏–∫—Å‚Äë–±–æ–Ω—É—Å—ã —Å—Ç–æ–ª–∞: –∫ <b>–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏</b> +2; –∫ –ø—Ä–æ—á–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∞–º <b>–õ–æ–≤–∫–æ—Å—Ç–∏</b> +4.</div>
          <div class="racefix"><b>–ë–∞–∑–æ–≤–∞—è —Ä–∞—Å–æ–≤–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:</b> –õ–æ–≤–∫–æ—Å—Ç—å +1, –•–∞—Ä–∏–∑–º–∞ +2, –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç ‚àí1.</div>
        </section>

        <!-- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–æ —Å—á—ë—Ç—á–∏–∫–∞–º–∏ -->
        <section class="card">
          <h2>–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h2>

          <div class="ability" data-counter data-key="invis" data-max="3">
            <img class="ability-icon" src="img/skill-invisible.png" alt="–ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: –ú–∞–ª–∞—è –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å" loading="lazy"/>
            <div>
              <b>–ú–∞–ª–∞—è –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å</b> <span class="small">(√ó3)</span>
              <div class="desc">–í –±–æ—é ‚Äî –¥–æ 2 —Ö–æ–¥–æ–≤ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ª—é–±—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º, –∫—Ä–æ–º–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è). –í–Ω–µ –±–æ—è ‚Äî –¥–æ —Å–º–µ–Ω—ã –ª–æ–∫–∞—Ü–∏–∏.</div>
            </div>
            <div class="counter-tools">
              <div class="pips" aria-label="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: –ú–∞–ª–∞—è –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å"></div>
            </div>
          </div>

          <div class="ability" data-counter data-key="illusion" data-max="5">
            <img class="ability-icon" src="img/skill-illusion.png" alt="–ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: –ú–∞–ª–∞—è –∏–ª–ª—é–∑–∏—è" loading="lazy"/>
            <div>
              <b>–ú–∞–ª–∞—è –∏–ª–ª—é–∑–∏—è</b> <span class="small">(√ó5)</span>
              <div class="desc">–û—Ç–≤–ª–µ–∫–∞—é—â–∏–π —Å–∏–ª—É—ç—Ç (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ—é). –î–µ—Ä–∂–∏—Ç—Å—è –¥–æ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è –∏–ª–∏ –¥–æ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è.</div>
            </div>
            <div class="counter-tools">
              <div class="pips" aria-label="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: –ú–∞–ª–∞—è –∏–ª–ª—é–∑–∏—è"></div>
            </div>
          </div>

          <div class="ability" data-counter data-key="fog" data-max="2">
            <img class="ability-icon" src="img/skill-fog-war.png" alt="–ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: –¢—É–º–∞–Ω –≤–æ–π–Ω—ã" loading="lazy"/>
            <div>
              <b>–¢—É–º–∞–Ω –≤–æ–π–Ω—ã</b> <span class="small">(√ó2)</span>
              <div class="desc">–û–±–ª–∞–∫–æ —Ç—å–º—ã; –≤—Ä–∞–≥–∏ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª—É—á–∞—é—Ç ‚àí4 –∫ –ø–æ–ø–∞–¥–∞–Ω–∏—é –Ω–∞ 3 —Ö–æ–¥–∞.</div>
            </div>
            <div class="counter-tools">
              <div class="pips" aria-label="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: –¢—É–º–∞–Ω –≤–æ–π–Ω—ã"></div>
            </div>
          </div>
        </section>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <section class="card">
          <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
          <div class="inv-list">

            <!-- –ü–∞—Ä–Ω—ã–µ –∫–∏–Ω–∂–∞–ª—ã -->
            <div class="item">
              <div class="mini" data-mini data-key="dagger1" data-default-src="img/knifes.png" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∫–æ–Ω–∫—É">
                <img alt="–ò–∫–æ–Ω–∫–∞ –∫–∏–Ω–∂–∞–ª–∞ 1"/>
                <span>–∏–∫–æ–Ω–∫–∞</span>
                <input type="file" accept="image/*" />
              </div>
              <div>
                <h3>–ü–∞—Ä–Ω—ã–µ –∫–∏–Ω–∂–∞–ª—ã</h3>
                <div class="sub">–£—Ä–æ–Ω: <b>2–∫4 + 2</b> (–∫–∞–∂–¥—ã–º)</div>
              </div>
            </div>

            <!-- –û—Ç–º—ã—á–∫–∏ √ó2 -->
            <div class="item">
              <div class="mini" data-mini data-key="picks" data-default-src="img/master-key.png" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∫–æ–Ω–∫—É">
                <img alt="–ò–∫–æ–Ω–∫–∞ –æ—Ç–º—ã—á–µ–∫"/>
                <span>–∏–∫–æ–Ω–∫–∞</span>
                <input type="file" accept="image/*" />
              </div>
              <div>
                <h3>–û—Ç–º—ã—á–∫–∏ √ó2</h3>
                <div class="sub">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –∑–∞–º–æ–∫ (1 –æ—Ç–º—ã—á–∫–∞ = 1 –∑–∞–º–æ–∫)</div>
              </div>
              <div class="controls" data-counter data-key="picks" data-max="2">
                <div class="pips" aria-label="–û—Å—Ç–∞–ª–æ—Å—å –æ—Ç–º—ã—á–µ–∫"></div>
              </div>
            </div>

            <!-- –ó–µ–ª—å–µ –ª–µ—á–µ–Ω–∏—è -->
            <div class="item">
              <div class="mini" data-mini data-key="potion" data-default-src="img/healing-potion.png" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∫–æ–Ω–∫—É">
                <img alt="–ò–∫–æ–Ω–∫–∞ –∑–µ–ª—å—è"/>
                <span>–∏–∫–æ–Ω–∫–∞</span>
                <input type="file" accept="image/*" />
              </div>
              <div>
                <h3>–ú–∞–ª–æ–µ –∑–µ–ª—å–µ –ª–µ—á–µ–Ω–∏—è</h3>
                <div class="sub">–≠—Ñ—Ñ–µ–∫—Ç: <b>1–∫8 + 2</b></div>
              </div>
              <div class="controls" data-counter data-key="potion" data-max="1">
                <div class="pips" aria-label="–û—Å—Ç–∞–ª–æ—Å—å –∑–µ–ª–∏–π"></div>
              </div>
            </div>

            <!-- –®–∫–∞—Ç—É–ª–∫–∞ -->
            <div class="item">
              <div class="mini" data-mini data-key="box" data-default-src="img/box.png" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∫–æ–Ω–∫—É">
                <img alt="–ò–∫–æ–Ω–∫–∞ —à–∫–∞—Ç—É–ª–∫–∏"/>
                <span>–∏–∫–æ–Ω–∫–∞</span>
                <input type="file" accept="image/*" />
              </div>
              <div>
                <h3>–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —à–∫–∞—Ç—É–ª–∫–∞</h3>
                <div class="sub">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç. –°–≤–æ–π—Å—Ç–≤–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.</div>
              </div>
            </div>

            <!-- –ë–∞—Ä–∞–±–∞–Ω—ã -->
            <div class="item">
              <div class="mini" data-mini data-key="drums" data-default-src="img/drum.png" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∫–æ–Ω–∫—É">
                <img alt="–ò–∫–æ–Ω–∫–∞ –±–∞—Ä–∞–±–∞–Ω–æ–≤"/>
                <span>–∏–∫–æ–Ω–∫–∞</span>
                <input type="file" accept="image/*" />
              </div>
              <div>
                <h3>–ë–∞—Ä–∞–±–∞–Ω—ã</h3>
                <div class="sub">–î–∞—é—Ç <b>–±–æ–Ω—É—Å –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è</b></div>
              </div>
              <div class="controls">
                <label class="small" for="drum-bonus">–ë–æ–Ω—É—Å:</label>
                <input id="drum-bonus" type="number" step="1" min="-10" max="10" style="width:70px; padding:6px; background:#111827; border:1px solid var(--border); border-radius:8px" />
              </div>
            </div>

          </div>
        </section>

        <!-- –ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è -->
        <section class="card">
          <h2>–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è</h2>
          <div class="story" id="story">
–ö–æ—Å—Ç–µ–¥—Ä–æ–± –¢—É–º–∞–Ω–æ—Ö–≤–æ—Å—Ç —Ä–æ–¥–æ–º —Å —Ç—É–º–∞–Ω–Ω—ã—Ö –æ–∫—Ä–∞–∏–Ω, –≥–¥–µ —Å–Ω–∞—á–∞–ª–∞ —É—á–∞—Ç—Å—è –ø—Ä—è—Ç–∞—Ç—å—Å—è, –∞ –ø–æ—Ç–æ–º ‚Äî –≥–æ–≤–æ—Ä–∏—Ç—å. 
–ï–≥–æ —Ä—É–∫–∏ –≤—Å–µ–≥–¥–∞ —Ç—è–Ω—É–ª–∏—Å—å –∫ —É–∑–ª–∞–º –∏ –∑–∞–º–∫–∞–º; –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ —Å—Ç–∞–ª–æ —Ä–µ–º–µ—Å–ª–æ–º, —Ä–µ–º–µ—Å–ª–æ ‚Äî –∫—Ä–∞–∂–∞–º–∏. 
–û–Ω –ø–µ—Ä–µ—à—ë–ª —á–µ—Ä—Ç—É: –æ–¥–Ω–∞ –Ω–æ—á—å, –æ–¥–∏–Ω —Å–µ–π—Ñ, –æ–¥–∏–Ω —Å–≤–∏–¥–µ—Ç–µ–ª—å. –°–ª—É—Ö–∏ –æ–∫–∞–∑–∞–ª–∏—Å—å –±—ã—Å—Ç—Ä–µ–µ –¥–µ–Ω–µ–≥ ‚Äî –∏ –∑–∞ –Ω–∏–º –ø–æ—Ç—è–Ω—É–ª—Å—è —Ö–≤–æ—Å—Ç –¥–æ–ª–≥–æ–≤ –∏ –æ–±–∏–¥.

–ö–æ–≥–¥–∞ –ø–µ—Ç–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞—Ç—è–≥–∏–≤–∞—Ç—å—Å—è, –î–∂–æ–Ω–Ω–∏ ¬´–ß—ë—Ä–Ω–∞—è –†—É–∫–∞¬ª –Ω–∞—à—ë–ª –µ–≥–æ –ø–µ—Ä–≤—ã–º. –ù–µ —Å—Ç—Ä–∞–∂–∞ –∏ –Ω–µ –≥–∏–ª—å–¥–∏—è ‚Äî –∏–º–µ–Ω–Ω–æ –î–∂–æ–Ω–Ω–∏. 
–í–º–µ—Å—Ç–æ –≤–µ—Ä—ë–≤–∫–∏ –æ–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª —Ä–∞–±–æ—Ç—É.
          </div>
        </section>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="toolbar">
          <div class="right">
            <button class="btn warn" id="reset-all">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
            <button class="btn" onclick="window.print()">–ü–µ—á–∞—Ç—å / PDF</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
  (function(){
    "use strict";

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const store = {
      get(key, fallback){
        try{ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
        catch(e){ return fallback; }
      },
      set(key, value){ try{ localStorage.setItem(key, JSON.stringify(value)); } catch(e){} },
      del(key){ try{ localStorage.removeItem(key); } catch(e){} },
      clear(){ localStorage.clear(); }
    };

    /* ---------- –°–ß–Å–¢–ß–ò–ö–ò (–ø–∏–ø—Å—ã) ---------- */
    class Counter {
      constructor(root){
        this.root = root;
        this.key  = root.dataset.key;
        this.max  = parseInt(root.dataset.max, 10) || 0;
        this.pipsWrap = $(".pips", root);
        this.state = store.get("counter:"+this.key, Array(this.max).fill(false));
        if (this.state.length !== this.max) this.state = Array(this.max).fill(false);
        this.render();
        this.bind();
      }
      render(){
        this.pipsWrap.innerHTML = "";
        this.state.forEach((used, idx)=>{
          const pip = document.createElement("button");
          pip.className = "pip";
          pip.type = "button";
          pip.dataset.idx = String(idx);
          pip.setAttribute("aria-pressed", used ? "true":"false");
          pip.title = used ? "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å." : "–î–æ—Å—Ç—É–ø–Ω–æ. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å.";
          pip.textContent = used ? "‚úì" : "";
          this.pipsWrap.appendChild(pip);
        });
      }
      bind(){
        this.pipsWrap.addEventListener("click", (e)=>{
          const pip = e.target.closest(".pip");
          if(!pip) return;
          const i = parseInt(pip.dataset.idx,10);
          this.state[i] = !this.state[i];
          store.set("counter:"+this.key, this.state);
          this.render();
        });
      }
    }
    const counters = [];
    $$("[data-counter]").forEach(el=>{
      if(el.classList.contains("ability") || el.classList.contains("controls")){
        counters.push(new Counter(el));
      }
    });

    /* ---------- –ü–û–†–¢–†–ï–¢ ---------- */
    store.del("img:portrait");

    function handleImageFile(file, targetKey, imgEl, onLoad){
      if(!file || !file.type.startsWith("image/")) return;
      const reader = new FileReader();
      reader.onload = () => {
        store.set(targetKey, reader.result);
        imgEl.src = reader.result;
        imgEl.style.display = "block";
        if(typeof onLoad === "function") onLoad();
      };
      reader.readAsDataURL(file);
    }

    /* ---------- –ò–ö–û–ù–ö–ò –ü–†–ï–î–ú–ï–¢–û–í (–º–∏–Ω–∏-–∫–≤–∞–¥—Ä–∞—Ç—ã) ---------- */
    function loadMini(key, rootEl){
      const data = store.get("img:mini:"+key, null);
      const img = $("img", rootEl);
      const label = rootEl.querySelector("span");
      const fallback = rootEl.dataset.defaultSrc || img.dataset.defaultSrc || "";
      if(data){
        img.src = data; img.style.display = "block";
        if(label) label.style.display = "none";
      } else if(fallback){
        img.src = fallback; img.style.display = "block";
        if(label) label.style.display = "none";
      } else {
        img.removeAttribute("src"); img.style.display = "none";
        if(label) label.style.display = "block";
      }
    }
    function bindMini(el){
      const key = el.dataset.key;
      const input = $("input[type=file]", el);
      loadMini(key, el);

      el.addEventListener("click", ()=> input.click());
      input.addEventListener("change", (e)=>{
        const file = e.target.files?.[0];
        if(!file) return;
        handleImageFile(file, "img:mini:"+key, $("img", el), ()=> loadMini(key, el));
        input.value = "";
      });
      el.addEventListener("dragover",(e)=>{ e.preventDefault(); el.style.outline="2px dashed var(--accent)"; });
      el.addEventListener("dragleave",()=>{ el.style.outline="none"; });
      el.addEventListener("drop",(e)=>{
        e.preventDefault(); el.style.outline="none";
        const file = e.dataTransfer.files?.[0];
        handleImageFile(file, "img:mini:"+key, $("img", el), ()=> loadMini(key, el));
      });
    }
    $$("[data-mini]").forEach(bindMini);

    /* ---------- –ë–æ–Ω—É—Å –±–∞—Ä–∞–±–∞–Ω–æ–≤ ---------- */
    const drumInput = $("#drum-bonus");
    drumInput.value = store.get("drum:bonus", "");
    drumInput.addEventListener("input", ()=>{
      store.set("drum:bonus", drumInput.value);
    });

    /* ---------- –°–±—Ä–æ—Å –≤—Å–µ–≥–æ ---------- */
    $("#reset-all").addEventListener("click", ()=>{
      if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å—á—ë—Ç—á–∏–∫–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è?")){
        Object.keys(localStorage).forEach(k=>{
          if(/^counter:|^img:|^drum:/.test(k)) localStorage.removeItem(k);
        });
        counters.forEach(c=>{ c.state = Array(c.max).fill(false); c.render(); });
        $$("[data-mini]").forEach(el=> loadMini(el.dataset.key, el));
        drumInput.value = "";
      }
    });

  })();
  </script>
</body>
</html>


